# Design Document

## 課題内容

- 宿題1: 乗算と除算に対応した電卓プログラムを実装する

- 宿題2: 宿題1で追加した機能が正しく動作するかチェックするためのテストケースを追加する

- 宿題3: 括弧に対応し、テストケースを追加する

- 宿題4: abs(), int(), round()に対応する
    

## 実装した電卓プログラムの仕様

- 入力：演算子が +, -, *, / のいずれかである四則演算式 

  - 空白文字を含んでいても良いとする
  
  - ただし、1つの数値内で空白文字を含む場合は不正な入力とみなす
    - 正しい入力例: 1.0 + 2.0 * 5.00
    - 不正な入力例: 1 .0 + 2 . 0 * 5. 0 0 
    
  - 演算子を1つも含んでいないものや、関数だけの式も受け付けることができる
    - 正しい入力例1: 4.0
    - 正しい入力例2: abs(-9.7+6*3) 
  
- 出力：入力として与えられた式の計算結果

- 全ての整数同士の四則演算に対応

- 与えられた式が括弧を含んでいてもよい

- 数値同士の演算だけでなく、関数の戻り値を非演算子とすることも可能  
  
  - abs(): 引数として与えられた値の絶対値を返す
    - 例1: abs(-3.1) = 3.1
    - 例2: abs(-9*5) = 45 (引数として式を指定することも可能)
 
  - int(): 引数として与えられた値の小数点以下を切り捨てた値を返す
    - 例1: int(9.3) = 9
    - 例2: int(7.589) = 7
  
  - round(): 引数として与えられた値を四捨五入した値を返す
    - 例1: round(9.3) = 9
    - 例2: round(7.589) = 8   

## 実装の方針
- EBNFを用いて、入力式を分解!

  - <式> = <項> | <式> + <項> | <式> - <項>
  - <項> = <因子> | <項> * <因子> | <項> / <因子>
  - <因子> = <数値> | (<式>) | abs(<式>) | int(<式>) | round(<式>)
  - <数値> = 'NUMBER' | -'NUMBER'
  - 'NUMBER'は負でない整数とする

- これで、「式の値を計算する」という責務を、いくつかの責務に分割できた  
- 後は、それぞれの責務を関数で実現するだけ


## テストケース
run_test()に追加したテストケースで確認している事項は、以下の通りである: 
- 負の数に対応しているか
- 演算子がない式に対応しているか
- それぞれの演算子について、正しく演算が行われているか
- それぞれの演算子について、計算の優先度が正しく実装されているか
- abs, int, round について、仕様通りに動作しているか
- 非演算子として関数、数値、(<式>)が混在する場合に正しく動作するか
- 入力式の空白文字を読み飛ばしているか

## 工夫した点
- 入力式に空白が含まれていたら読み飛ばすようにした
- 関数の引数として式を与えられるようにした

### どのあたりが「最強の美」なのか？
- 宿題4: モジュール化度合いはどうだったのか？
   - 実装の方向性を決めるのに何も迷わなかった
   - 他の機能を簡単に追加できる
   - 例え、優先度の異なる演算子が登場してもEBNFの書き換えで対応できる
    
- 電卓プログラムを実装する他の手法
  - 数式を逆ポーランド記法に変換して、スタックを用いて演算を行う
    - 1+3*4 → 1 3 4 * +
    - (3+5)*(2+8) → 3 5 + 2 8 + *
    - 数式を逆ポーランド記法に変換できれば、演算自体はそこまで大変ではない
    - ただ、逆ポーランド記法が直感的にわかりにくいのでデバッグしにくそう
  
  


